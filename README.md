# RPC框架简化版

会开发cpp和rust两个版本，附上相应的tutorial

# 开发流程及已完成部分
1. 实现核心的 Reactor 模式。
- 构造函数创建了一个 epoll 实例。
- add_handler 方法允许添加一个文件描述符和对应的处理函数。
- remove_handler 方法允许移除一个文件描述符的处理。
- run 方法启动事件循环，持续监听事件并调用相应的处理函数。
- stop 方法用于停止事件循环
2. 开发基本的网络通信功能。
- 创建一个 TCP 服务器，绑定到指定的 IP 和端口。
- 使用 Reactor 模式处理新的连接和数据接收。
- 提供设置连接处理和数据接收处理函数的接口。
- 处理非阻塞 I/O。
3. 实现消息序列化和反序列化。
- 支持基本类型（bool, int32_t, int64_t, float, double）和字符串的序列化和反序列化。
- 使用小端字节序（little-endian）进行序列化。
- 提供了错误检查，当尝试读取超出缓冲区范围的数据时抛出异常。

>这个序列化系统可以与之前实现的网络通信功能结合使用，允许在网络上传输复杂的数据结构。例如，可以创建一个 Message 类，使用 >Serializer 将其转换为字节流，然后通过 TcpServer 发送，在接收端使用 Deserializer 重建消息。

4. 添加连接池和内存池管理。

连接池：

- 支持最大连接数限制
- 使用条件变量实现线程安全的连接获取和释放
- 允许自定义连接创建逻辑

内存池：

- 支持固定大小的内存块分配和释放
- 使用空闲链表管理未使用的内存块
- 在需要时自动分配新的内存块

5. 实现服务发现和负载均衡功能。

服务注册表：

- 支持服务的注册和注销
- 提供获取服务实例列表的方法
- 使用互斥锁确保线程安全


负载均衡器：

- 使用简单的轮询策略选择服务实例
- 与服务注册表集成

6. 开发监控和日志系统。

日志系统：

- 支持不同的日志级别
- 可以同时输出到控制台和文件
- 包含时间戳和线程ID
- 线程安全


监控系统：

- 支持计数器、仪表盘和直方图三种基本指标类型
- 线程安全
- 提供简单的接口来收集和查询指标

7. 单元测试和性能测试。

使用Google Test框架

8. 示例展示中间件的使用。

编译:

```bash
mkdir build && cd build
cmake ..
make
```

单元测试:

```bash
./unit_tests
```

性能测试:

```bash
./benchmark_tcp_server
```

9. 优化性能，处理边缘情况。


# 优化和拓展思路（TODO LISTS）

1. Reactor 模式： 
- 使用智能指针管理资源。
- 添加错误处理和日志记录。
- 实现定时器功能。
- 支持写事件。
- 使用线程池处理长时间运行的任务。

2. 网络通信功能：

- 实现 UDP 服务器（类似的方式，但使用 SOCK_DGRAM）。
- 创建一个通用的 Protocol 类，用于处理不同的协议（如 HTTP、WebSocket 等）。
- 实现客户端功能，允许主动建立连接和发送数据。
- 添加 SSL/TLS 支持，提高安全性。
- 实现更高级的错误处理和日志记录。

3. 序列化与反序列化
- 添加对复杂数据结构（如数组、映射等）的支持。
- 实现版本控制机制，以支持向后兼容性。
- 添加压缩功能以减少数据大小。
- 实现对自定义类型的序列化支持。
- 考虑使用更高效的编码方式，如变长整数编码。
- 添加校验和或其他错误检测机制。

4. 连接池和内存池

- 为连接池添加空闲连接超时和定期健康检查。
- 在内存池中实现不同大小的内存块分配。
- 添加性能统计和监控功能。
- 实现自动扩展和收缩池大小的策略。
- 为内存池添加内存对齐支持，以优化缓存使用。

5. 实现服务发现和负载均衡功能。

- 实现更复杂的负载均衡策略，如加权轮询、最少连接数等。
- 添加服务健康检查机制。
- 实现动态服务发现，如集成 etcd 或 Consul。
- 添加服务版本管理和兼容性检查。
- 实现服务熔断和限流功能。
- 添加缓存层以提高服务发现的性能。
- 实现分布式一致性协议，如 Raft，以确保服务注册表的高可用性。

6. 开发监控和日志系统。

- 添加结构化日志支持，便于后续分析。
- 实现日志轮转功能，防止日志文件过大。
- 添加更多的指标类型，如百分位数、移动平均等。
- 实现指标的定期导出功能，以便与外部监控系统集成。
- 添加分布式追踪功能，以便在分布式系统中跟踪请求流程。
- 实现一个简单的 HTTP 服务器，用于实时查询指标。
- 添加警报功能，当某些指标超过阈值时发送通知。

7. 单元测试和性能测试。
8. 示例展示中间件的使用。
9. 优化性能，处理边缘情况。